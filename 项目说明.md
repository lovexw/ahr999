# AHR999 指数网站 - 项目完整说明

## 📋 项目概述

这是一个完整的 AHR999 比特币定投指标网站，专为部署到 Cloudflare Pages/Workers 设计。

### 核心特性

✅ **自动化运行**
- 每小时通过 Cloudflare Cron Triggers 自动更新
- 无需人工干预，完全自动化
- 数据存储在 Cloudflare KV 中，全球分布

✅ **美观界面**
- 参考专业网站配色设计
- 深色主题，护眼舒适
- 响应式设计，完美支持移动端
- 流畅的动画效果

✅ **完整 API**
- RESTful API 设计
- CORS 支持，可跨域调用
- 多个端点满足不同需求
- JSON 格式，易于集成

✅ **稳定可靠**
- 部署在 Cloudflare 全球网络
- 99.99% 可用性
- 自动 HTTPS
- CDN 加速

## 📂 项目结构

```
ahr999-index/
│
├── public/                      # 前端静态文件
│   ├── index.html              # 主页面 - 展示 AHR999 指数
│   ├── test.html               # 测试页面 - 验证所有功能
│   ├── style.css               # 样式文件 - 美观的界面设计
│   ├── script.js               # 前端脚本 - 数据获取和图表
│   ├── manifest.json           # PWA 配置
│   ├── robots.txt              # SEO 爬虫配置
│   ├── sitemap.xml             # 网站地图
│   └── _headers                # Cloudflare 头部配置
│
├── functions/                   # Cloudflare Workers 函数
│   ├── scheduled.js            # 定时任务 - 每小时更新数据
│   ├── init.js                 # 初始化端点 - 手动触发更新
│   ├── health.js               # 健康检查 - 监控系统状态
│   └── api/                    # API 端点目录
│       ├── ahr999.js          # 获取最新 AHR999 数据
│       ├── history.js         # 获取历史数据（30天）
│       └── stats.js           # 获取统计信息
│
├── 文档/
│   ├── README.md               # 项目主文档（英文/中文）
│   ├── 快速开始.md             # 快速部署指南
│   ├── DEPLOY.md               # 详细部署文档
│   ├── FAQ.md                  # 常见问题解答
│   ├── CONTRIBUTING.md         # 贡献指南
│   ├── CHANGELOG.md            # 更新日志
│   └── 项目说明.md             # 本文件
│
├── 配置文件/
│   ├── wrangler.toml           # Cloudflare Workers 配置
│   ├── package.json            # Node.js 项目配置
│   ├── .gitignore              # Git 忽略配置
│   ├── .env.example            # 环境变量示例
│   ├── .prettierrc             # 代码格式化配置
│   └── LICENSE                 # MIT 许可证
│
└── .github/
    └── workflows/
        └── deploy.yml.example  # GitHub Actions 部署示例
```

## 🎯 功能详解

### 1. 主页面 (index.html)

**核心展示区域：**
- 🔢 当前 AHR999 指数（大字显示）
- 🎯 投资信号（抄底/定投/观望/减仓/逃顶）
- 💰 比特币当前价格
- 📊 200日移动平均线
- 💡 投资建议

**指标说明区域：**
- 详细的区间说明
- 彩色标签区分
- 易于理解的建议

**历史数据图表：**
- Canvas 绘制
- 实时更新
- 阈值线标注
- 响应式适配

**API 文档：**
- 嵌入式文档
- 示例代码
- 响应格式说明

### 2. API 接口

#### `/api/ahr999` - 获取最新数据
```javascript
{
  "timestamp": 1704067200000,
  "date": "2024-01-01T00:00:00.000Z",
  "currentPrice": 50000,
  "ma200": 40000,
  "ahr999": 1.5625,
  "signal": "观望区间",
  "signalColor": "#ffaa00",
  "advice": "持币观望，不建议操作"
}
```

#### `/api/history` - 获取历史数据
返回数组，包含最近 30 天的所有数据点

#### `/api/stats` - 获取统计信息
```javascript
{
  "dataPoints": 720,
  "period": { "start": "...", "end": "..." },
  "ahr999": {
    "current": 1.5,
    "min": 0.3,
    "max": 6.8,
    "avg": 2.1,
    "median": 1.8
  },
  "price": { ... },
  "signals": {
    "抄底区间": 50,
    "定投区间": 200,
    "观望区间": 400,
    "减仓区间": 60,
    "逃顶区间": 10
  }
}
```

#### `/health` - 健康检查
```javascript
{
  "status": "healthy",
  "timestamp": 1704067200000,
  "services": {
    "kv": "operational",
    "api": "operational"
  },
  "lastUpdate": "2024-01-01T00:00:00.000Z",
  "hoursSinceUpdate": 0
}
```

### 3. 测试页面 (test.html)

**功能测试：**
- ✅ API 端点测试
- ✅ 数据格式验证
- ✅ 健康状态检查
- ✅ 前端资源加载
- ✅ 测试摘要统计

**一键测试：**
运行所有测试，快速验证部署是否成功

### 4. 定时任务 (scheduled.js)

**执行频率：** 每小时（可配置）

**工作流程：**
1. 从 CoinGecko API 获取当前比特币价格
2. 获取过去 200 天的历史价格数据
3. 计算 200 日移动平均线
4. 计算 AHR999 指数
5. 确定投资信号和建议
6. 存储到 Cloudflare KV
7. 清理 30 天前的历史数据

**容错机制：**
- Try-catch 错误处理
- 详细日志记录
- 失败不影响现有数据

## 🚀 部署流程

### 最简单的方式（推荐）

1. **Fork 或上传项目到 GitHub**

2. **在 Cloudflare Dashboard 中：**
   - Workers & Pages → Create application → Pages
   - 连接 GitHub 仓库
   - 构建配置留空，输出目录：`public`
   - 部署

3. **创建 KV 命名空间：**
   - Workers & Pages → KV
   - 创建命名空间：`AHR999_DATA`

4. **绑定 KV 到项目：**
   - 项目 Settings → Functions → KV namespace bindings
   - 变量名：`AHR999_DATA`
   - 选择刚创建的命名空间

5. **配置 Cron Trigger：**
   - Settings → Functions → Cron Triggers
   - 添加：`0 * * * *`

6. **初始化数据：**
   - 访问：`https://your-project.pages.dev/init`

7. **验证部署：**
   - 访问：`https://your-project.pages.dev/test.html`

**完成！** 🎉

## 💰 成本分析

### Cloudflare 免费套餐额度：

| 服务 | 免费额度 | 项目使用 | 状态 |
|------|----------|---------|------|
| Pages | 无限请求 | 无限 | ✅ 充足 |
| Workers | 100,000 请求/天 | ~2,000/天 | ✅ 充足 |
| KV 读取 | 100,000 次/天 | ~2,000/天 | ✅ 充足 |
| KV 写入 | 1,000 次/天 | 24 次/天 | ✅ 充足 |
| Cron Triggers | 包含在 Workers 中 | 24 次/天 | ✅ 充足 |

**结论：完全免费，无需任何费用！** 💵

即使每天有 1000+ 访问量，也完全在免费额度内。

## 🔧 配置选项

### 修改更新频率

编辑 `wrangler.toml`：

```toml
[triggers]
crons = ["0 * * * *"]      # 每小时
# crons = ["*/30 * * * *"]  # 每30分钟
# crons = ["0 */2 * * *"]   # 每2小时
```

### 修改历史数据保留期

编辑 `functions/scheduled.js`：

```javascript
const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
// 改为 60 天
const sixtyDaysAgo = Date.now() - (60 * 24 * 60 * 60 * 1000);
```

### 添加自定义域名

在 Cloudflare Dashboard：
- 项目 Settings → Custom domains
- 添加域名
- 配置 DNS（CNAME 记录）

## 📊 数据来源

### CoinGecko API

**优点：**
- ✅ 免费使用
- ✅ 可靠稳定
- ✅ 全球价格汇总
- ✅ 提供历史数据

**限制：**
- 免费版：50 请求/分钟
- 本项目使用：每小时 2 次请求
- 完全在限制内

**端点：**
- `/simple/price` - 当前价格
- `/coins/bitcoin/market_chart` - 历史数据

## 🎨 设计理念

### 颜色方案

参考 https://hab-130.pages.dev/hab-b 的配色：

```css
--primary-bg: #0a0e27      /* 深蓝色背景 */
--secondary-bg: #141a36    /* 次要背景 */
--card-bg: #1a2142         /* 卡片背景 */
--accent-color: #4c6ef5    /* 强调色 */
--text-primary: #e4e7eb    /* 主要文字 */
--text-secondary: #9ca3af  /* 次要文字 */
```

### 设计原则

1. **简洁清晰** - 重要信息突出显示
2. **视觉层次** - 合理的信息架构
3. **响应式** - 移动端优先
4. **可访问性** - 考虑色盲用户
5. **性能** - 快速加载

## 🔍 SEO 优化

- ✅ 语义化 HTML
- ✅ Meta 标签完善
- ✅ Open Graph 支持
- ✅ Twitter Cards
- ✅ robots.txt
- ✅ sitemap.xml
- ✅ 结构化数据（可添加）

## 🛡️ 安全性

- ✅ HTTPS 强制
- ✅ CORS 配置
- ✅ 无用户数据收集
- ✅ 开源透明
- ✅ 无后门

## 📈 性能指标

**预期性能：**
- 首次加载：< 2s
- API 响应：< 100ms
- 图表渲染：< 500ms
- 全球访问：< 50ms（CDN）

**优化措施：**
- 静态资源 CDN
- KV 边缘缓存
- 最小化 JavaScript
- CSS 优化

## 🤝 贡献和支持

### 如何贡献

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 发起 Pull Request

查看 [CONTRIBUTING.md](CONTRIBUTING.md) 了解详情

### 获取帮助

- 📚 查看文档
- 🐛 提交 Issue
- 💬 GitHub Discussions
- 📧 联系维护者

## 📝 许可证

MIT License - 完全开源，商业使用友好

## 🎯 未来规划

查看 [CHANGELOG.md](CHANGELOG.md) 了解详细的路线图：

- 更多比特币指标
- 通知功能
- 用户系统
- 多语言支持
- 移动应用
- AI 分析

## ⭐ 致谢

感谢所有贡献者和使用者！

如果这个项目对你有帮助，请给个 Star ⭐️

---

**项目状态：** ✅ 生产就绪  
**最后更新：** 2024-01-01  
**版本：** 1.0.0

祝投资顺利！🚀📈
