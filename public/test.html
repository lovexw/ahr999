<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AHR999 æµ‹è¯•é¡µé¢</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0e27;
            color: #e4e7eb;
            padding: 40px 20px;
            line-height: 1.6;
        }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { color: #4c6ef5; margin-bottom: 20px; }
        h2 { color: #748ffc; margin-top: 30px; margin-bottom: 15px; }
        .test-section {
            background: #1a2142;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2d3748;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.pending { background: #666; color: white; }
        .status.success { background: #00cc00; color: white; }
        .status.error { background: #ff0000; color: white; }
        .result {
            background: #0a0e27;
            border: 1px solid #2d3748;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Monaco', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
        }
        .result pre { color: #a8dadc; }
        button {
            background: #4c6ef5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
        }
        button:hover { background: #5c7cfa; }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        .info { color: #9ca3af; font-size: 0.9rem; margin-top: 5px; }
        .error-msg { color: #ff6b6b; margin-top: 10px; }
        .summary {
            background: linear-gradient(135deg, rgba(76, 110, 245, 0.1), rgba(76, 110, 245, 0.05));
            border: 2px solid #4c6ef5;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª AHR999 æµ‹è¯•é¡µé¢</h1>
        <p>ä½¿ç”¨æ­¤é¡µé¢æµ‹è¯•æ‰€æœ‰ API ç«¯ç‚¹å’ŒåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>

        <div class="summary" id="summary">
            <h2>æµ‹è¯•æ‘˜è¦</h2>
            <div class="summary-item">
                <span>æ€»æµ‹è¯•æ•°ï¼š</span>
                <strong id="total-tests">0</strong>
            </div>
            <div class="summary-item">
                <span>é€šè¿‡ï¼š</span>
                <strong id="passed-tests" style="color: #00cc00;">0</strong>
            </div>
            <div class="summary-item">
                <span>å¤±è´¥ï¼š</span>
                <strong id="failed-tests" style="color: #ff0000;">0</strong>
            </div>
        </div>

        <button onclick="runAllTests()" id="run-all-btn">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>

        <h2>API ç«¯ç‚¹æµ‹è¯•</h2>

        <div class="test-section">
            <h3>1. è·å–æœ€æ–° AHR999 æ•°æ® <span class="status pending" id="status-ahr999">å¾…æµ‹è¯•</span></h3>
            <p class="info">GET /api/ahr999</p>
            <button onclick="testAHR999()">æµ‹è¯•æ­¤ç«¯ç‚¹</button>
            <div class="result" id="result-ahr999" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>2. è·å–å†å²æ•°æ® <span class="status pending" id="status-history">å¾…æµ‹è¯•</span></h3>
            <p class="info">GET /api/history</p>
            <button onclick="testHistory()">æµ‹è¯•æ­¤ç«¯ç‚¹</button>
            <div class="result" id="result-history" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>3. è·å–ç»Ÿè®¡ä¿¡æ¯ <span class="status pending" id="status-stats">å¾…æµ‹è¯•</span></h3>
            <p class="info">GET /api/stats</p>
            <button onclick="testStats()">æµ‹è¯•æ­¤ç«¯ç‚¹</button>
            <div class="result" id="result-stats" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>4. å¥åº·æ£€æŸ¥ <span class="status pending" id="status-health">å¾…æµ‹è¯•</span></h3>
            <p class="info">GET /health</p>
            <button onclick="testHealth()">æµ‹è¯•æ­¤ç«¯ç‚¹</button>
            <div class="result" id="result-health" style="display: none;"></div>
        </div>

        <h2>å‰ç«¯åŠŸèƒ½æµ‹è¯•</h2>

        <div class="test-section">
            <h3>5. é¡µé¢åŠ è½½ <span class="status pending" id="status-page">å¾…æµ‹è¯•</span></h3>
            <p class="info">æ£€æŸ¥ä¸»é¡µé¢æ˜¯å¦èƒ½æ­£å¸¸è®¿é—®</p>
            <button onclick="testPage()">æµ‹è¯•é¡µé¢</button>
            <div class="result" id="result-page" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>6. æ ·å¼æ–‡ä»¶ <span class="status pending" id="status-css">å¾…æµ‹è¯•</span></h3>
            <p class="info">æ£€æŸ¥ CSS æ–‡ä»¶æ˜¯å¦èƒ½æ­£å¸¸åŠ è½½</p>
            <button onclick="testCSS()">æµ‹è¯•æ ·å¼</button>
            <div class="result" id="result-css" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>7. JavaScript æ–‡ä»¶ <span class="status pending" id="status-js">å¾…æµ‹è¯•</span></h3>
            <p class="info">æ£€æŸ¥ JS æ–‡ä»¶æ˜¯å¦èƒ½æ­£å¸¸åŠ è½½</p>
            <button onclick="testJS()">æµ‹è¯•è„šæœ¬</button>
            <div class="result" id="result-js" style="display: none;"></div>
        </div>
    </div>

    <script>
        let testResults = { total: 0, passed: 0, failed: 0 };

        function updateSummary() {
            document.getElementById('total-tests').textContent = testResults.total;
            document.getElementById('passed-tests').textContent = testResults.passed;
            document.getElementById('failed-tests').textContent = testResults.failed;
        }

        function setStatus(id, status, message = '') {
            const statusEl = document.getElementById(`status-${id}`);
            const resultEl = document.getElementById(`result-${id}`);
            
            statusEl.className = `status ${status}`;
            statusEl.textContent = status === 'success' ? 'âœ“ é€šè¿‡' : status === 'error' ? 'âœ— å¤±è´¥' : 'å¾…æµ‹è¯•';
            
            if (message) {
                resultEl.style.display = 'block';
                resultEl.innerHTML = `<pre>${message}</pre>`;
            }

            testResults.total++;
            if (status === 'success') testResults.passed++;
            if (status === 'error') testResults.failed++;
            updateSummary();
        }

        async function testAHR999() {
            try {
                const response = await fetch('/api/ahr999');
                const data = await response.json();
                
                if (response.ok && data.ahr999) {
                    setStatus('ahr999', 'success', JSON.stringify(data, null, 2));
                } else {
                    setStatus('ahr999', 'error', `é”™è¯¯: ${JSON.stringify(data, null, 2)}`);
                }
            } catch (error) {
                setStatus('ahr999', 'error', `é”™è¯¯: ${error.message}\n\nè¯·å…ˆè®¿é—® /init åˆå§‹åŒ–æ•°æ®`);
            }
        }

        async function testHistory() {
            try {
                const response = await fetch('/api/history');
                const data = await response.json();
                
                if (response.ok && Array.isArray(data)) {
                    setStatus('history', 'success', `æ‰¾åˆ° ${data.length} æ¡å†å²è®°å½•\n\n${JSON.stringify(data.slice(0, 2), null, 2)}\n...`);
                } else {
                    setStatus('history', 'error', `é”™è¯¯: ${JSON.stringify(data, null, 2)}`);
                }
            } catch (error) {
                setStatus('history', 'error', `é”™è¯¯: ${error.message}`);
            }
        }

        async function testStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                if (response.ok && data.ahr999) {
                    setStatus('stats', 'success', JSON.stringify(data, null, 2));
                } else {
                    setStatus('stats', 'error', `é”™è¯¯: ${JSON.stringify(data, null, 2)}`);
                }
            } catch (error) {
                setStatus('stats', 'error', `é”™è¯¯: ${error.message}`);
            }
        }

        async function testHealth() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                
                if (data.status === 'healthy' || data.status === 'degraded') {
                    setStatus('health', 'success', JSON.stringify(data, null, 2));
                } else {
                    setStatus('health', 'error', JSON.stringify(data, null, 2));
                }
            } catch (error) {
                setStatus('health', 'error', `é”™è¯¯: ${error.message}`);
            }
        }

        async function testPage() {
            try {
                const response = await fetch('/');
                if (response.ok) {
                    setStatus('page', 'success', `é¡µé¢å“åº”: ${response.status} ${response.statusText}`);
                } else {
                    setStatus('page', 'error', `é¡µé¢å“åº”: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                setStatus('page', 'error', `é”™è¯¯: ${error.message}`);
            }
        }

        async function testCSS() {
            try {
                const response = await fetch('/style.css');
                if (response.ok) {
                    setStatus('css', 'success', `CSS æ–‡ä»¶åŠ è½½æˆåŠŸ (${response.headers.get('content-length')} bytes)`);
                } else {
                    setStatus('css', 'error', `CSS å“åº”: ${response.status}`);
                }
            } catch (error) {
                setStatus('css', 'error', `é”™è¯¯: ${error.message}`);
            }
        }

        async function testJS() {
            try {
                const response = await fetch('/script.js');
                if (response.ok) {
                    setStatus('js', 'success', `JS æ–‡ä»¶åŠ è½½æˆåŠŸ (${response.headers.get('content-length')} bytes)`);
                } else {
                    setStatus('js', 'error', `JS å“åº”: ${response.status}`);
                }
            } catch (error) {
                setStatus('js', 'error', `é”™è¯¯: ${error.message}`);
            }
        }

        async function runAllTests() {
            const btn = document.getElementById('run-all-btn');
            btn.disabled = true;
            btn.textContent = 'æµ‹è¯•ä¸­...';
            
            testResults = { total: 0, passed: 0, failed: 0 };
            
            await testAHR999();
            await new Promise(r => setTimeout(r, 500));
            await testHistory();
            await new Promise(r => setTimeout(r, 500));
            await testStats();
            await new Promise(r => setTimeout(r, 500));
            await testHealth();
            await new Promise(r => setTimeout(r, 500));
            await testPage();
            await new Promise(r => setTimeout(r, 500));
            await testCSS();
            await new Promise(r => setTimeout(r, 500));
            await testJS();
            
            btn.disabled = false;
            btn.textContent = 'é‡æ–°è¿è¡Œæ‰€æœ‰æµ‹è¯•';
        }
    </script>
</body>
</html>
